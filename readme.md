<div align="center">

```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—      â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘      â–ˆâ–ˆâ•‘     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•      â•šâ•â•      â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•
```

### ğŸ” Sistema Web de Escaneo de CÃ³digos de Barras con IntegraciÃ³n POS

[![Python](https://img.shields.io/badge/Python-3.10+-3776AB?style=for-the-badge&logo=python&logoColor=white)](https://python.org)
[![Flask](https://img.shields.io/badge/Flask-2.x-000000?style=for-the-badge&logo=flask&logoColor=white)](https://flask.palletsprojects.com)
[![MySQL](https://img.shields.io/badge/MySQL-8.0-4479A1?style=for-the-badge&logo=mysql&logoColor=white)](https://mysql.com)
[![Docker](https://img.shields.io/badge/Docker-Compose-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://docker.com)
[![License](https://img.shields.io/badge/Licencia-Propietaria-red?style=for-the-badge)](.)

<br/>

> **ActualizÃ¡ precios, gestionÃ¡ productos y generÃ¡ etiquetas de gÃ³ndola**  
> **desde cualquier dispositivo â€” sin tocar la computadora de caja.**

</div>

---

## ğŸ“Œ Â¿QuÃ© es Escaner-POS?

**Escaner-POS** es una plataforma SaaS **multicliente** que permite a supermercados y comercios gestionar su catÃ¡logo de productos de forma centralizada. El sistema POS del local consume los precios actualizados vÃ­a API REST, eliminando la necesidad de intervenir fÃ­sicamente en la caja registradora para cada cambio.

```
          CELULAR / TABLET                     CAJA REGISTRADORA
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ğŸ“· Escanear     â”‚                   â”‚   ğŸ’» POS / Caja  â”‚
        â”‚  cÃ³digo barras  â”‚                   â”‚                  â”‚
        â”‚                 â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  consulta precio â”‚
        â”‚  âœï¸  Editar       â”œâ”€â”€â–ºâ”‚  API REST â”‚â—„â”€â”€â”‚  en tiempo real  â”‚
        â”‚  precio/nombre  â”‚   â”‚  (Flask)  â”‚   â”‚                  â”‚
        â”‚                 â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚  ğŸ·ï¸  Generar      â”‚         â”‚
        â”‚  etiqueta PDF   â”‚   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  MySQL DB â”‚
                              â”‚ por clienteâ”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ¨ CaracterÃ­sticas Principales

| Feature | DescripciÃ³n |
|---|---|
| ğŸ“± **EscÃ¡ner Web** | Lector de cÃ³digos de barras desde la cÃ¡mara del celular/tablet, sin apps nativas |
| ğŸ¢ **Multicliente** | Cada comercio tiene su propio subdominio y base de datos aislada |
| ğŸ”„ **SincronizaciÃ³n en tiempo real** | Los cambios de precio se reflejan instantÃ¡neamente en el POS |
| ğŸ·ï¸ **Generador de etiquetas** | Crea etiquetas de gÃ³ndola en PDF listas para imprimir |
| ğŸ” **Auth por Bearer Token** | Cada cliente tiene un token Ãºnico de 32 caracteres |
| ğŸŒ **SSL automÃ¡tico** | Certificados wildcard via Let's Encrypt por subdominio |
| âš¡ **Alta/baja instantÃ¡nea** | Activar o desactivar clientes sin reiniciar el servidor |
| ğŸ“Š **Logs de acceso** | AuditorÃ­a completa de requests por cliente |

---

## ğŸ—ï¸ Arquitectura

```
comparappargentina.com                â†’  Panel de administraciÃ³n / Landing
cliente1.comparappargentina.com       â†’  Supermercado 1
cliente2.comparappargentina.com       â†’  Supermercado 2
sanmartin.comparappargentina.com      â†’  Supermercado San MartÃ­n
          ...
```

### Flujo de autenticaciÃ³n

```
  Request  â”€â”€â–º  Nginx  â”€â”€â–º  Flask extrae subdominio
                               â”‚
                               â–¼
                    Busca cliente en comparapp_admin
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Valida Bearer Token â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ âœ… VÃ¡lido                          â”‚ âŒ InvÃ¡lido
              â–¼                                   â–¼
    Conecta a cliente_X_db                   401 / 403
    y procesa el request
```

### Base de datos

- **`comparapp_admin`** â€” Tabla de clientes, tokens, logs de acceso
- **`cliente_X`** â€” Una base de datos independiente por cliente con tabla `products`

---

## ğŸš€ InstalaciÃ³n

### Requisitos previos

```bash
apt update
apt install -y docker docker-compose python3-pip mysql-client

pip3 install flask pymysql gunicorn
```

### 1. Clonar el repositorio

```bash
git clone https://github.com/tu-usuario/escaner-pos.git
cd escaner-pos
```

### 2. Variables de entorno

Crear archivo `.env` en la raÃ­z:

```env
MYSQL_ROOT_PASSWORD=tu_password_seguro
FLASK_SECRET_KEY=tu_secret_key_random
```

### 3. Configurar base de datos

```bash
mysql -u root -p
source setup_database.sql
```

Esto crea automÃ¡ticamente:
- Base de datos `comparapp_admin` con tabla de clientes
- 2 clientes de ejemplo con sus respectivas bases de datos

### 4. Configurar DNS Wildcard

En tu proveedor DNS (Cloudflare, Route53, etc.):

```
Type    Name                        Value
A       comparappargentina.com      123.45.67.89
A       *.comparappargentina.com    123.45.67.89
```

### 5. Obtener certificado SSL Wildcard

```bash
apt install certbot

certbot certonly --manual --preferred-challenges dns \
  -d comparappargentina.com \
  -d *.comparappargentina.com
```

### 6. Levantar servicios

```bash
# Con Docker Compose (recomendado)
docker-compose up -d

# O directamente
python3 app.py
```

---

## ğŸ“¡ API Reference

Todos los endpoints requieren:

```http
Authorization: Bearer <token_del_cliente>
Host: <subdominio>.comparappargentina.com
```

### Endpoints

#### `GET /api/producto/<codigo>`
Obtener un producto por cÃ³digo de barras.

```json
{
  "encontrado": true,
  "code": "7790895000010",
  "name": "Coca Cola 2L",
  "pricebuy": 1500.00,
  "pricesell": 2000.00,
  "stockunits": 50
}
```

#### `POST /api/producto`
Crear o actualizar un producto.

```json
{
  "code": "7790895000010",
  "name": "Coca Cola 2.25L",
  "pricebuy": 1600,
  "pricesell": 2100,
  "margen": 30
}
```

#### `DELETE /api/producto/<codigo>`
Eliminar un producto del catÃ¡logo.

#### `GET /api/productos`
Listar todos los productos del cliente.

#### `GET /api/pos/precio/<codigo>` â€” *Endpoint para POS*
Consulta pÃºblica simplificada, pensada para integrar directamente con el sistema de caja.

```json
{
  "encontrado": true,
  "codigo": "7790895000010",
  "nombre": "Coca Cola 2L",
  "precio": 2000.00
}
```

#### `GET /api/health`
Health check del servicio.

```json
{ "status": "ok", "service": "comparapp" }
```

---

## ğŸ”§ AdministraciÃ³n de Clientes

```bash
python3 admin_cliente.py
```

| OpciÃ³n | AcciÃ³n |
|--------|--------|
| 1 | Listar todos los clientes (activos e inactivos) |
| 2 | Crear cliente nuevo con BD automÃ¡tica |
| 3 | Ver token de acceso |
| 4 | Regenerar token |
| 5 | Activar / Desactivar cliente |
| 6 | âš ï¸ Eliminar cliente y su BD (irreversible) |

**Ejemplo â€” dar de alta un cliente:**

```bash
python3 admin_cliente.py
# Seleccionar opciÃ³n 2

ğŸ“ Nombre del cliente: Supermercado San Martin
ğŸŒ Subdominio: sanmartin

âœ… Base de datos: cliente_sanmartin
âœ… Tabla products creada
âœ… Token: abc123xyz789...
âœ… URL: https://sanmartin.comparappargentina.com
```

---

## ğŸ”„ IntegraciÃ³n con POS

Ejemplo de integraciÃ³n con Unicenta / Chromis u otro sistema POS:

```python
import requests

def obtener_precio(codigo_barras):
    url = f"https://micliente.comparappargentina.com/api/pos/precio/{codigo_barras}"
    headers = {"Authorization": "Bearer mi_token_secreto"}

    try:
        response = requests.get(url, headers=headers, timeout=5)
        if response.ok:
            data = response.json()
            if data['encontrado']:
                return data['precio']
    except Exception:
        pass

    # Fallback a precio local si la API no responde
    return consultar_precio_local(codigo_barras)
```

---

## ğŸ”’ Seguridad

- âœ… HTTPS obligatorio con certificados Let's Encrypt
- âœ… Token Ãºnico de 32 caracteres por cliente
- âœ… ValidaciÃ³n de subdominio â€” un cliente no puede acceder a datos de otro
- âœ… Rate limiting configurado en Nginx
- âœ… Headers de seguridad: HSTS, X-Frame-Options, etc.
- âœ… Logs de auditorÃ­a por cliente

**Buenas prÃ¡cticas recomendadas:**
- Rotar tokens cada 3â€“6 meses
- Mantener solo los puertos 80, 443 y 22 abiertos en el firewall
- Configurar backups automÃ¡ticos (ver secciÃ³n de mantenimiento)

---

## ğŸ› ï¸ Mantenimiento

### Backup automÃ¡tico

```bash
#!/bin/bash
# backup.sh
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backups"

mysqldump -u root -p comparapp_admin > $BACKUP_DIR/admin_$DATE.sql

mysql -u root -p -e "SHOW DATABASES LIKE 'cliente_%'" | grep cliente_ | while read db; do
    mysqldump -u root -p $db > $BACKUP_DIR/${db}_$DATE.sql
done

tar -czf $BACKUP_DIR/backup_$DATE.tar.gz $BACKUP_DIR/*.sql
rm $BACKUP_DIR/*.sql
```

Agregar a cron para ejecutar diariamente a las 3AM:

```bash
crontab -e
# Agregar:
0 3 * * * /root/backup.sh
```

### Actualizar el cÃ³digo

```bash
git pull origin main
docker-compose restart app nginx
```

### Ver logs en tiempo real

```bash
docker logs -f comparapp_app      # AplicaciÃ³n Flask
docker logs -f comparapp_nginx    # Nginx
docker logs -f comparapp_mysql    # MySQL
```

---

## ğŸ“ˆ Escalabilidad

Para instalaciones con mÃ¡s de 50 clientes simultÃ¡neos:

- **Redis** para cachear consultas frecuentes de productos
- **Load Balancer** con Nginx + mÃºltiples instancias Flask
- **BDs dedicadas** para clientes con alto volumen de requests
- **CDN** para archivos estÃ¡ticos y PDFs de etiquetas

---

## ğŸ› Troubleshooting

<details>
<summary><b>âŒ Error: Cliente no encontrado</b></summary>

**Causa:** El subdominio no existe en `comparapp_admin.clientes`

```sql
SELECT * FROM comparapp_admin.clientes WHERE subdominio = 'micliente';
```
Si no aparece, crearlo con `admin_cliente.py` opciÃ³n 2.
</details>

<details>
<summary><b>âŒ Error: Token invÃ¡lido (401/403)</b></summary>

**Causa:** Token incorrecto o cliente desactivado.

```bash
python3 admin_cliente.py
# OpciÃ³n 4: Regenerar token
# OpciÃ³n 5: Verificar que el cliente estÃ© activo
```
</details>

<details>
<summary><b>âŒ Error: Base de datos no existe</b></summary>

```sql
CREATE DATABASE cliente_nombre CHARACTER SET utf8mb4;
USE cliente_nombre;
-- Ejecutar script de tabla products
```
</details>

<details>
<summary><b>âŒ Error: SSL certificate expirado</b></summary>

```bash
certbot renew --force-renewal
docker-compose restart nginx
```
</details>

---

## ğŸ§° Stack TecnolÃ³gico

| Capa | TecnologÃ­a |
|------|-----------|
| Backend | Python 3.10+, Flask |
| Base de datos | MySQL 8 |
| Proxy / SSL | Nginx + Let's Encrypt |
| Infraestructura | Docker, Docker Compose |
| Cloud | VPS Ubuntu 24.04 LTS |
| PDF (etiquetas) | ReportLab |
| Frontend | HTML, CSS, JavaScript |

---

## ğŸ“ Contacto

**Joaquin Papagianacopoulos** â€” Desarrollador & Co-fundador

[![LinkedIn](https://img.shields.io/badge/LinkedIn-joaquinpapagianacopoulos-0077B5?style=for-the-badge&logo=linkedin)](https://www.linkedin.com/in/joaquinpapagianacopoulos/)
[![Gmail](https://img.shields.io/badge/Gmail-joaquinpapagianacopoulos@gmail.com-D14836?style=for-the-badge&logo=gmail&logoColor=white)](mailto:joaquinpapagianacopoulos@gmail.com)
[![WhatsApp](https://img.shields.io/badge/WhatsApp-%2B54%209%2011%2064703346-25D366?style=for-the-badge&logo=whatsapp&logoColor=white)](https://wa.me/5491164703346)

---

<div align="center">

**Escaner-POS** Â· Hecho con ğŸ§‰ desde Buenos Aires, Argentina

*Â© 2026 Joaquin Papagianacopoulos â€” Todos los derechos reservados*

</div>
